getICESrect<-function(HHobj=NA,Survey="SP-PORC",years=c(2011:2017),quarter=4,latname=0,longname=0,inclArea=T) {
if (is.na(HHobj) DB<-data.table::as.data.table(icesDatras::getDATRAS("HH",Survey,years,quarter))
else DB<-HHobj
names(DB)<-tolower(names(DB))
if (grep("statrec",names(DAT))==0) {
if (latname==0) latname=grep("lat",names(DB))
if (longname==0) longname=grep("long",names(DB))
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlat<-cut(DB[,latname],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
DB$statrec<-paste0(DB$rectlat,DB$rectlong)
}
DB$icesSub<-Area[match(DB[,"statrec"],Area$ICESNAME),"Area_27"]
DB
}
source('~/github/DATRASlfd/R/ICES_rects.R', echo=TRUE)
getICESrect()
source('~/github/DATRASlfd/R/ICES_rects.R', echo=TRUE)
getICESrect()
source('~/github/DATRASlfd/R/ICES_rects.R', echo=TRUE)
getICESrect()
source('~/github/DATRASlfd/R/ICES_rects.R', echo=TRUE)
getICESrect()
mtrace(getICESrect)
library(debug)
read.delim("c:/users/francisco.velasco.st/descktop/asfis_sp.txt")
dir("c:/users/francisco.velasco.ST/desktop/")
read.delim("c:/users/francisco.velasco.ST/desktop/asphis_sp.txt")
read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt")
str(read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt"))
str(read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt",as.is=T))
3code<-as.data.table(read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt",as.is=T))
code3<-as.data.table(read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt",as.is=T))
str(code3)
ls()
speciesAB
library(DATRASlfd)
speciesAB
load("~/github/DATRASlfd/data/speciesAB.rda")
speciesAB
str(speciesAB)
code3[code3$Scientic_name==as.character(speciesAB$Species),code3$X3A_CODE]
speciesAB$A3Code<-code3[code3$Scientic_name==as.character(speciesAB$Species),code3$X3A_CODE]
speciesAB$A3Code<-code3[match(code3$Scientic_name,as.character(speciesAB$Species)),code3$X3A_CODE]
speciesAB$A3Code<-code3[match(code3$Scientic_name,as.character(speciesAB$Species)),code3$X3A_CODE]
match(code3$Scientific_name,as.character(speciesAB$Species))
code3[match(code3$Scientific_name,as.character(speciesAB$Species)),"A3code")
names(code3)
code3[match(code3$Scientific_name,as.character(speciesAB$Species)),"X3A_CODE")
code3[match(code3$Scientific_name,as.character(speciesAB$Species)),"X3A_CODE"]
as.characther(code3$X3A_CODE)
as.character(code3$X3A_CODE)
code3$X3A_CODE<-as.characther(code3$X3A_CODE)
code3$X3A_CODE<-as.character(code3$X3A_CODE)
code3[match(code3$Scientific_name,as.character(speciesAB$Species)),"X3A_CODE"]
str(speciesABSpecies)
str(speciesAB$Species)
speciesAB$Species<-as.character(speciesAB$Species)
code3[match(code3$Scientific_name,as.character(speciesAB$Species)),"X3A_CODE"]
str(speciesAB$Species)
? read.table.url
? read.table
data.table("https://datras.ices.dk/WebServices/DATRASWebService.asmx/getHHdata?survey=SP-PORC&year=2016&quarter=3")
data.table(https://datras.ices.dk/WebServices/DATRASWebService.asmx/getHHdata?survey=SP-PORC&year=2016&quarter=3)
load("~/github/DATRASlfd/data/speciesAB.rda")
code3<-as.data.table(read.delim("c:/users/francisco.velasco.ST/desktop/asfis_sp.txt",as.is=T))
speciesAB
str(speciesAB)
DB<-CampR::datlan.camp("N15","Cant",redux=T)
DB
latname="lat"
longname="long"
tolower(names(DB))
(grep("statrec",names(DB))==0)
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
library(DATRASlfd)
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
library(XML2R)
XML2R("https://datras.ices.dk/WebServices/DATRASWebService.asmx/getHHdata?survey=SP-PORC&year=2016&quarter=3")
library(DATRASlfd)
head(speciesAB)
fao3<-read.delim(strinsAsFactors=T,file="C:/users/francisco.velasco.ST/github/trials/asfis.txt")
read.delim(file="C:/users/francisco.velasco.ST/github/trials/asfis.txt")
read.delim(file="C:/users/francisco.velasco.ST/documents/github/trials/asfis.txt")
fao<-read.delim(file="C:/users/francisco.velasco.ST/documents/github/trials/asfis.txt")
str(fao)
fao<-read.csv(stringsAsFactors=T,sep="\",file="C:/users/francisco.velasco.ST/documents/github/trials/asfis.txt")
? read.csv
fao<-read.csv(stringsAsFactors=T,sep="\t",file="C:/users/francisco.velasco.ST/documents/github/trials/asfis.txt")
fao
str(fao)
fao<-read.csv(stringsAsFactors=F,sep="\t",file="C:/users/francisco.velasco.ST/documents/github/trials/asfis.txt")
str(fao)
names(speciesAB)
names(fao)
merge(speciesAB,fao[,3,4],by.x="Species","Scientific_name",all.x=T,all.y=F)
merge(speciesAB,fao[,3,4],by.x="Species",by.y="Scientific_name",all.x=T,all.y=F)
merge(speciesAB,fao[,c(3,4)],by.x="Species",by.y="Scientific_name",all.x=T,all.y=F)
speciesAB<-merge(speciesAB,fao[,c(3,4)],by.x="Species",by.y="Scientific_name",all.x=T,all.y=F)
devtools::use_data(speciesAB,overwrite = T)
library(DATRASlfd)
head(speciesAB)
speciesAB[is.na(speciesAB$X3A_CODE),]
speciesAB<-edit(speciesAB)
speciesAB[is.na(speciesAB$X3A_CODE),]
speciesAB<-edit(speciesAB)
speciesAB[is.na(speciesAB$X3A_CODE),]
rm(speciesAB)
speciesAB
speciesAB<-edit(speciesAB)
speciesAB
devtools::use_data(speciesAB,overwrite = T)
library(DATRASlfd)
speciesAB[is.na(speciesAB$X3A_CODE),]
speciesAB[speciesAB$aphia==999,]
speciesAB
speciesAB[B<2,]
speciesAB[speciesAB$B<2,]
speciesAB[B<3,]
speciesAB[speciesAB$B<3,]
speciesAB[speciesAB$B<3 & speciesAB$aphia>130000,]
duplicated(speciesAB$X3A_CODE)
speciesAB[duplicated(speciesAB$X3A_CODE),]
speciesAB[speciesAB$X3A_CODE=="GUR",]
speciesAB<-edit(speciesAB)
speciesAB[speciesAB$X3A_CODE=="GUR",]
speciesAB[duplicated(speciesAB$X3A_CODE),]
devtools::use_data(speciesAB,overwrite = T)
HHDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
HLDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
HHDB$StNo
HLDB<-data.table::as.data.table(icesDatras::getDATRAS("HL",Survey,years,quarter))
Survey="SP-PORC"
years=c(2011:2017)
quarter=3
HLDB<-data.table::as.data.table(icesDatras::getDATRAS("HL",Survey,years,quarter))
HLDB<-subset(HLDB,year>2015)
library(data.table)
HLDB<-subset(HLDB,year>2015)
str(HLDB)
HLDB<-data.table::subset(HLDB,year>2015)
?? subset
HLDB[HLDB$Year>2015,]
HLDB<-HLDB[HLDB$Year>2015,]
HHDB<-getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
HHDB[HHDB$year>2015,]
HHDB<-HHDB[HHDB$year>2015,]
HLDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
HHDB$StNo
names(HHDB)
HHDB$stno
HLDB$stno
HLDB$HaulVal<-HLDB$HaulVal[match(HLDB$StNo,HHDB$stno)]
HLDB$StNo
match(HLDB$StNo,HHDB$stno)
HLDB$HaulVal[match(HLDB$StNo,HHDB$stno)]
names(HHDB)
names(HLDB)
HHDB<-data.table::as.data.table(icesDatras::getDATRAS("HH",Survey,2016:2017,quarter))
names(HHDB)
library(DATRASlfd)
getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
getICESrect()
DB<-data.table::as.data.table(icesDatras::getDATRAS("HH",Survey,years,quarter))
head(DB)
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
#names(DB)<-tolower(names(DB))
if (length(grep("StatRec",names(DB)))==0) {
if (latname==0) latname=grep("ShootLat",names(DB))
if (longname==0) longname=grep("ShootLong",names(DB))
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlat<-cut(DB[,latname],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
DB$statrec<-paste0(DB$rectlat,DB$rectlong)
DB$rectlat <- NULL
DB$rectlong <- NULL
}
DB
(length(grep("StatRec",names(DB)))==0)
grep("ShootLat",names(DB))
latname=grep("ShootLat",names(DB))
longname=grep("ShootLong",names(DB))
DB$rectlong<-cut(DB[,longname],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB[,longname]
longname
DB[,20]
as.vector(DB[,20])
DB[,"ShootLat"]
DB[,get(names(DB)[ColNb=19])]
DB[,get(names(DB)[ColNb=latname])]
cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels)
DB$rectlong<-cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlat<-cut(DB[,get(names(DB)[ColNb=latname])],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
paste0(DB$rectlat,DB$rectlong)
source('~/github/DATRASlfd/R/getICESrect.R', echo=TRUE)
getICESrect()
years=2016:2017
DB<-data.table::as.data.table(icesDatras::getDATRAS("HH",Survey,years,quarter))
(length(grep("StatRec",names(DB)))==0)
cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
cut(DB[,get(names(DB)[ColNb=latname])],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
paste0(DB$rectlat,DB$rectlong)
cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlong<-cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlat<-cut(DB[,get(names(DB)[ColNb=latname])],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
DB$statrec<-paste0(DB$rectlat,DB$rectlong)
DB$rectlat <- NULL
DB$rectlong <- NULL
DB$StatRec<-paste0(DB$rectlat,DB$rectlong)
DB
Area[match(DB$statrec,Area$ICESNAME),"Area_27"]
library(DATRASlfd)
getICESrect()
DB<-data.table::as.data.table(icesDatras::getDATRAS("HH",Survey,years,quarter))
(length(grep("StatRec",names(DB)))==0)
ls()
latname=0
longname=0
(length(grep("StatRec",names(DB)))==0)
grep("StatRec",names(DB))
DB$StatRec
#names(DB)<-tolower(names(DB))
if (length(grep("StatRec",names(DB)))==0) {
if (latname==0) latname=grep("ShootLat",names(DB))
if (longname==0) longname=grep("ShootLong",names(DB))
DB$rectlong<-cut(DB[,DB[,get(names(DB)[ColNb=longname])]],breaks=seq(from=-30,to=40,by=1),labels=lebels) # ,"D9","D8"
DB$rectlat<-cut(DB[,get(names(DB)[ColNb=latname])],breaks=seq(from=36.0,to=71,by=.5),labels=formatC(c(1:70),flag=0,width=2))
DB$StatRec<-paste0(DB$rectlat,DB$rectlong)
DB$rectlat <- NULL
DB$rectlong <- NULL
}
Area[match(DB$StatRec,Area$ICESNAME),"Area_27"]
DB$icesSub<-Area[match(DB$StatRec,Area$ICESNAME),"Area_27"]
DB
library(DATRASlfd)
getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
library(debug)
mtrace(getICESrect)
getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
ls()
getICESrect
rm(getICESrect)
getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
HLDB<-data.table::as.data.table(icesDatras::getDATRAS("HL",Survey,years,quarter))
HHDB<-getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$A3_CODE==Esp])
Esp="MEG"
subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$A3_CODE==Esp])
HLDB$Valid_Aphia
speciesAB$aphia[speciesAB$A3_CODE==Esp]
speciesAB$aphia
speciesAB$A3_CODE
speciesAB
speciesAB$aphia[speciesAB$X3A_CODE==Esp]
HLDB<-subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$X3A_CODE==Esp])
!is.na(speciesAB$aphia[speciesAB$X3A_CODE==Esp]))
!is.na(speciesAB$aphia[speciesAB$X3A_CODE==Esp])
speciesAB$aphia[speciesAB$X3A_CODE==Esp] $ !is.na()
speciesAB$aphia[speciesAB$X3A_CODE==Esp] & !is.na()
speciesAB$aphia[speciesAB$X3A_CODE==Esp & !is.na(speciesAB$X3A_CODE)]
subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$X3A_CODE==Esp & !is.na(speciesAB$X3A_CODE)])
if (!is.na(Esp)) HLDB<-subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$X3A_CODE==Esp & !is.na(speciesAB$X3A_CODE)])
HLDB<-HLDB[HLDB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1")]
HLDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
HLDB$StNo
HHDB$StNo
names(HLDB)
HLDB<-data.table::as.data.table(icesDatras::getDATRAS("HL",Survey,years,quarter))
HHDB<-getICESrect(Survey = Survey,years = years,quarter=quarter,inclArea = T)
if (!is.na(Esp)) HLDB<-subset(HLDB,Valid_Aphia==speciesAB$aphia[speciesAB$X3A_CODE==Esp & !is.na(speciesAB$X3A_CODE)])
HLDB[HLDB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1")]
HLDB$LngtCode
HLDB
HLDB[HLDB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1").keep]
HLDB[HLDB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1")]
HLDB[LngtCode=="1",]
HLDB[LngtCode=="1","LngtClass"]
HLDB[LngtCode=="1","LngtClass"]/10
HLDB[HLDB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),)]
HLDB[LngtCode==".","LngtClass"]/10
HLDB
names(speciesAB)
HLDB$LngtCode=="."
length(HLDB$LngtCode==".")
any(HLDB$LngtCode==".")
HLDB[HLDB$LngtCode=="1",]$LngtClass/10
HLDB$LngtClass(HLDB$LngtCode==".")
HLDB$LngtClass[HLDB$LngtCode=="."]
HLDB$LngtClass[HLDB$LngtCode=="1"]
trunc(HLDB[HLDB$LngtCode=="1",]$LngtClass/10,0)
HLDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
HLDB$HaulVal
names(HLDB)
match(HLDB$StNo,HHDB$StNo)
nrow(HLDB)
nrow(HHDB)
match(HLDB$StNo,HHDB$StNo)
match(HLDB$StNo,HHDB$StNo)
HHDB$HaulVal[match(HLDB$StNo,HHDB$StNo)]
DB<-getICESrect(Survey="IE-IGFS",years=2017,quarter=4)
DB
db
ls()
DB
DB<-rbind(DB,HLDB)
names(DB)
names(DB)
names(HLDB)
DB<-getDATRAS("HL","IE-IGFS",years=2016:2017,quarter=4)
DB<-icesDatras::getDATRAS("HL","IE-IGFS",years=2016:2017,quarter=4)
rbind(HLDB,DB)
dbi<-rbind(HLDB,DB)
dbi$LngtCode
unique(dbi$LngtCode)
nDB<-setdiff(colnames(DB),"LngtClass")
DB[DB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nDB]
DB[DB$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nDB]
nDB
DB[DB$LngtCode==".",.((LngtClass=trunc(LngtClass/10,0),LngtCode="1")),by=nDB]
library(icesDatras)
library(NeAtlIBTS)
HH=data.table(getDATRAS("HH","SP-PORC",2011:2017,3))
HL=data.table(getDATRAS("HL","SP-PORC",2011:2017,3))
HH=rbind(HH,data.table(getDATRAS("HH","SP-NORTH",2011:2017,4)))
HL=rbind(HL,data.table(getDATRAS("HL","SP-NORTH",2011:2017,4)))
HLi=data.table(getDATRAS("HL","IE-IGFS",2011:2017,4))
nHL<-setdiff(colnames(HLi), "LngtClass")
HLi[HLi$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nHL]
HLi=data.table(getDATRAS("HL","IE-IGFS",2016:2017,4))
HLi=rbind(NLi,data.table(getDATRAS("HL","SP-PORC",2016:2017,3)))
HLi=rbind(HLi,data.table(getDATRAS("HL","SP-PORC",2016:2017,3)))
HLi
unique(HLi$LngtCode)
nrow(HLi)
HLi[is.na(HLi$LngtCode),]
HLi[!is.na(HLi$LngtCode),]
HLi<-HLi[!is.na(HLi$LngtCode),]
nHL<-setdiff(colnames(HLi), "LngtClass")
HLi[HLi$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nHL]
nrow(HLi)
HLib<-HLi[HLi$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nHL]
nrow(HLib)
unique(HLib$Survey)
unique(HLib$LngtCode)
nrow(subset(HLi,Survey=="SP-PORC"))
nrow(subset(HLi,Survey=="IE-IGFS"))
nrow(subset(HLib,Survey=="IE-IGFS"))
nrow(subset(HLib,Survey=="IE-IGFS"))
nrow(subset(HLib,Survey=="SP-PORC"))
HLib[HLib$Survey=="SP-PORC",]
HLi=data.table(getDATRAS("HL","IE-IGFS",2016,4))
nrow(HLi)
HLi=rbind(HLi,data.table(getDATRAS("HL","SP-PORC",2016,3)))
nHL<-setdiff(colnames(HLi), "LngtClass")
nrow(HLi)
51888-38196
unique(HLi$LngtCode)
HLb<-HLi[HLi$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nHL]
nrow(HLb)
tapply(HLb$Survey,HLb$Survey,"length")
tapply(HLi$Survey,HLi$Survey,"length")
unique(HLi$LngtCode)
HLi[HLi$LngtCode==c("1"),"Survey"]
HLi[HLi$LngtCode==c("."),"Survey"]
ls()
dbi
rm(dbi)
ls()
rm(list=ls())
HL<-getDATRAS("HL","SP-PORC",2016,3)
HL<-rbind(HL,getDATRAS("HL","IE-IGFS",2016,4))
HL<-HL[HL$Valid_Aphia=="127146",]
nrow(HL)
nrow(subset(HL,HL$LngtCode=="."))
nrow(subset(HL,HL$LngtCode=="1"))
nrow(subset(HL,HL$Survey=="SP-PORC"))
nHL<-setdiff(colnames(HL), "LngtClass")
HLb<-HL[HL$LngtCode==".",.(LngtClass=trunc(LngtClass/10,0),LngtCode="1"),by=nHL]
nHL
require(microbenchmark)
microbenchmark(subset(airquality, Month == 8 & Temp > 90),airquality[airquality$Month == 8 & airquality$Temp > 90,])
Unit: microseconds
expr     min       lq   median       uq     max neval
subset(airquality, Month == 8 & Temp > 90) 301.994 312.1565 317.3600 349.4170 500.903   100
airquality[airquality$Month == 8 & airquality$Temp > 90, ] 234.807 239.3125 244.2715 271.7885 340.058   100
MBM<-microbenchmark(subset(airquality, Month == 8 & Temp > 90),airquality[airquality$Month == 8 & airquality$Temp > 90,])
ggplot2::autoplot(MBM)
windows()
ggplot2::autoplot(MBM)
hbp<-getDATRAS("HL","SP-PORC",2016,3)
microbenchmark(
hbp1<-hbp[hbp$Valid_Aphia=="127146",],
hbp2<-subset(hbp,hbp$Valid_Aphia=="127146"),
unit="s",
times = 3)
hbi<-getDATRAS("HL","IE-IGFS",2016,4)
mbp<-microbenchmark(
hbp1<-hbp[hbp$Valid_Aphia=="127146",],
hbp2<-subset(hbp,hbp$Valid_Aphia=="127146"),
unit="s",
times = 3)
print(mbp,units="s")
mbp<-microbenchmark(
hbp1<-hbp[hbp$Valid_Aphia=="127146",],
hbp2<-subset(hbp,hbp$Valid_Aphia=="127146"),
unit="s",
times = 100)
print(mbp,units="s")
mbp<-microbenchmark(
hbp1<-hbp[hbp$Valid_Aphia=="127146",],
hbp2<-subset(hbp,hbp$Valid_Aphia=="127146"),
unit="s",
times = 1000)
print(mbp,units="s")
ggplot2:autoplot(mbp)
ggplot2::autoplot(mbp)
windows()
ggplot2::autoplot(mbp)
hbi<-hbp[hbi$Valid_Aphia=="127146",]
nHL<-setdiff(colnames(HL), "LngtClass")
hbp<-getDATRAS("HL","SP-PORC",2016,3)
hbp<-hbp[hbp$Valid_Aphia=="127146",]
hbi<-getDATRAS("HL","IE-IGFS",2016,4)
hbi<-hbp[hbi$Valid_Aphia=="127146",]
hbp<-getDATRAS("HL","SP-PORC",2016,3)
hbp<-hbp[hbp$Valid_Aphia=="127146",];nrow(nbp)
hbp<-getDATRAS("HL","SP-PORC",2016,3)
hbp<-icesDatras::getDATRAS("HL","SP-PORC",2016,3)
hbi<-icesDatras::getDATRAS("HL","IE-IGFS",2016,4)
hbi
hbp
nrow(hbp)
hbi<-icesDatras::getDATRAS("HL","IE-IGFS",2016,4)
hbi<-hbp[hbi$Valid_Aphia=="127146",]
tapply(hbp$LngtCode,hbp$LngtCode,"length")
tapply(hbp$LngtCode,hbp[,c("LngtCode","Survey"),"length")
tapply(hbp$LngtCode,hbp[,c("LngtCode","Survey")],"length")
ls()
tapply(hbp1$LngtCode,hbp1[,c("LngtCode","Survey")],"length")
tapply(hbp2$LngtCode,hbp2[,c("LngtCode","Survey")],"length")
rm(hbp1,hbp2)
nHL<-setdiff(colnames(hbp), "LngtClass")
nHL<-setdiff(colnames(hbp1), "LngtClass")
nHL<-setdiff(colnames(hbp), "LngtClass")
hbp1<-hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10),LngtCode="1"),by=nHL]
hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10),LngtCode="1")]
hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10),LngtCode="1"),]
as.data.able(hbp)
data.table::as.data.table(hbp)
hbp<-data.table::as.data.table(hbp)
hbp1<-hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10),LngtCode="1"),by=nHL]
nrow(nbp1)
nrow(hbp1)
nrow(hbp)
head(hbp)
head(hbp1)
names(hbp)
names(hbp1)
match(names(hbp),names(hbp1))
cbind(names(hbp),names(hbp1))
ncols(hbp)
ncol(hbp)
ncol(hbp1)
match(names(hbp1),names(hbp))
match(names(hbp),names(hbp1))
hbp$Survey
unique(hbp$Survey)
unique(hbp1$Survey)
setdiff(hbp1,hbp)
setdiff(hbp1$HLNoAtLngt,hbp$HLNoAtLngt)
setdiff(hbp1$StNo,hbp$StNo)
?setdiff
hbi<-icesDatras::getDATRAS("HL","IE-IGFS",2016,4)
intersect(hbp,hbp1)
intersect(hbp,hbp)
setdiff(hbp,hbp1)
intersect(hbp,hbp1)
setdiff(hbp,hbp1)
hbp
hbp1
names(hbp)
names(hbp1)
hbp1[,24]
hbp1[,23]
hbp1[,c(23,28)]
hbp1<-hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10)),by=nHL]
hbp1[,c(23,28)]
names(hbp)
names(hbp1)
cbind(hbp[,"LngtClass"],hbp1[,"LngtClass"])
cbind(hbp[,"NoMeas"],hbp1[,"NoMeas"])
hbp$index<-c(1:nrow(hbp))
nHL<-setdiff(colnames(hbp), "LngtClass")
hbp1<-hbp[hbp$LngtCode=="1",.(LngtClass=c(LngtClass/10)),by=nHL]
cbind(hbp[,"index"],hbp1[,"index"])
cbind(hbp[,"LngtClass"],hbp1[,"LngtClass"])
cbind(hbp[,c("LngtClass","index")],hbp1[,c("LngtClass","index")])
names(hbp)
,names(hbp1)
names(hbp1)
hbi<-icesDatras::getDATRAS("HL","IE-IGFS",2016,4)
library(CampR
)
buscacod("Seriola")
maphist(1,209,Nsh,"Cant",plot=F,out.dat=T,ceros=F)
dumb<-foreign::read.dbf("c:/camp/espcd17.dbf",as.is = T)
dumb<-foreign::read.dbf("c:/camp/espcd217.dbf",as.is = T)
dumb$ESPECIE=="Serio"
dumb$ESPECIE=="Trach"
substr(dumb$ESPECIE,1,5)=="Trach"
substr(dumb$ESPECIE,1,5)=="Serio"
rm(dumb)
library(DATRASlfd)
library(DATRASlfd)
